#!/bin/sh

help() {
	echo "code-format - format code syntax for better style

USAGE:
	code-format [OPTION]... <FILE>

OPTIONS:
	-i  make changes to file in place
	-h  show this help message"
}

err() { printf 'code-format: %s\n' "$@" >&2; exit 1; }
while getopts 'h' o; do case "$o" in
	i) iflag=0 ;;
	h) help; exit ;;
	*) err "invalid option -- '$OPTARG'" ;;
esac done
shift $((OPTIND - 1))

python_file() {
	[ "$iflag" = 0 ] && set -- -i
	autopep8 "$@"
}

case "$1" in
	'') help >&2 ;;
	*.py) python_file "$@" ;;
	*)
		case "$(file --mime-type --brief "$1")" in
			text/x-script.python) python_file "$@" ;;
			*) err "$1: uncrecognized file type" ;;
		esac
esac
